# 워크플로우의 이름
name: Update Notion ETF Prices

# 이 워크플로우가 언제 실행될지를 정의합니다.
on:
  # 1. 스케줄 실행: 매시 정각에 실행
  schedule:
    - cron: "0 * * * *"

  # 2. 수동 실행: GitHub의 Actions 탭에서 수동으로 실행 버튼 추가
  workflow_dispatch:

jobs:
  update-prices:
    runs-on: ubuntu-latest

    steps:
      # 1단계: 코드를 가져옵니다. (기본 위치는 저장소 루트입니다)
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2단계: Python 설치 (버전을 3.10으로 업그레이드하여 yfinance 호환성 해결)
      - name: Set up Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      # 3단계: 라이브러리 설치
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 4단계: 파이썬 스크립트 실행
      - name: Run Python script to update Notion
        env:
          NOTION_API_KEY: ${{ secrets.NOTION_API_KEY }}
          DATABASE_ID: ${{ secrets.DATABASE_ID }}
        run: python main.py
